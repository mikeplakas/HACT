<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>@ViewData["Title"] - HACT</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
    @await Html.PartialAsync("__css")
    @await RenderSectionAsync("Styles", required: false)
</head>

<body>
    @{
        bool isAdmin = User.Identity?.IsAuthenticated == true && User.IsInRole("Admin");
        string adminName = User.Identity?.Name ?? "";
    }

    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner"></div>
    </div>
    <!-- Spinner End -->

    <!-- Topbar Start -->
    @await Html.PartialAsync("__Topbar")
    <!-- Topbar End -->

    <!-- Navbar & Carousel Start -->
    @await Html.PartialAsync("__Navbar")
    <!-- Navbar & Carousel End -->

    <!-- Full Screen Search Start -->
    @await Html.PartialAsync("__FullScreenSearch")
    <!-- Full Screen Search End -->

    @RenderBody()

    <!-- Footer Start -->
    @await Html.PartialAsync("__Footer")
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square rounded back-to-top">
        <i class="bi bi-arrow-up"></i>
    </a>

    @await Html.PartialAsync("__js")
    @await RenderSectionAsync("Scripts", required: false)

    @if (isAdmin)
    {
        <script src="https://unpkg.com/@@microsoft/signalr@7.0.5/dist/browser/signalr.min.js"></script>

        <script>
            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/notificationHub")
                .build();

            connection.on("ReceiveMessage", function (message, unreadCount) {
                // Toast
                const toast = document.createElement("div");
                toast.className = "toast align-items-center text-bg-primary border-0 show position-fixed bottom-0 end-0 m-3";
                toast.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">${message}</div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>`;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 5000);

                // Badge update
                const badge = document.querySelector("#unreadBadge");
                if (badge) {
                    badge.textContent = unreadCount;
                    badge.style.display = unreadCount > 0 ? "inline-block" : "none";
                }
            });

            connection.start().catch(err => console.error("SignalR Error: ", err));
        </script>
    }



</body>

</html>
